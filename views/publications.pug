extends layout
include mixins/display_publications

block content
	main.col-xs-12
		.show
			span Show: 
			label(for='journal')
				if journal
					input(type='checkbox' id='journal' name='journal' onclick='showPubs(true);' checked)
				else
					input(type='checkbox' id='journal' name='journal' onclick='showPubs(true);')
				| Journal articles
			label(for='conference')
				if conference
					input(type='checkbox' id='conference' name='conference' onclick='showPubs(true);' checked)
				else
					input(type='checkbox' id='conference' name='conference' onclick='showPubs(true);')
				| Conference papers
			label(for='workshop')
				if workshop
					input(type='checkbox' id='workshop' name='workshop' onclick='showPubs(true);' checked)
				else
					input(type='checkbox' id='workshop' name='workshop' onclick='showPubs(true);')
				| Lightly reviewed papers (workshop papers, posters)
			label(for='book')
				if book
					input(type='checkbox' id='book' name='book' onclick='showPubs(true);' checked)
				else
					input(type='checkbox' id='book' name='book' onclick='showPubs(true);')
				| Books and book chapters
		hr.publications
		+display_publications(bib, true)
		script.
			var mapping = {'journal':['journal'], 'conference':['paper', 'note'], 'workshop':['organizer', 'wip', 'workshop', 'poster'], 'book':['dissertation']};
			function showPubs(animate) {
				var allChecked = [];
				$('input:checkbox').each(function () {
					var checked = this.checked;
					mapping[$(this).attr('name')].forEach(function(n) {
						if(animate) {
							checked?$('cite.' + n).slideDown('fast').css('display', 'block'):$('cite.' + n).slideUp('fast');
						} else {
							checked?$('cite.' + n).show().css('display', 'block'):$('cite.' + n).hide();
						}
						if(checked) {
							allChecked.push(n);
						}
					});
				});
				//Hide/show publication years
				var bib = !{JSON.stringify(bib)};
				var years = jQuery.unique(bib.map(function(b) { return b.YEAR; }));
				var yearsFiltered = jQuery.unique(bib.filter(function(b) { return allChecked.indexOf(b.type) != -1;}).map(function(b) { return b.YEAR; }));
				years.forEach(function(y) {
					if(animate) {
						yearsFiltered.indexOf(y) != -1?$('h2.' + y).slideDown('fast'):$('h2.' + y).slideUp('fast');
					} else {
						yearsFiltered.indexOf(y) != -1?$('h2.' + y).show():$('h2.' + y).hide();
					}
				});
			}
			showPubs(false);
			